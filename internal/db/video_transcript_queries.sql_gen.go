// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: video_transcript_queries.sql

package db

import (
	"context"

	"github.com/jackc/pgx/v5/pgtype"
	"thirdcoast.systems/rewind/pkg/utils/language"
)

const upsertVideoTranscript = `-- name: UpsertVideoTranscript :exec
INSERT INTO video_transcripts (
    video_id,
    lang,
    format,
    text,
    search,
    raw,
    updated_at
)
VALUES (
    $1,
    $2::language_tag,
    $3,
    $4,
    to_tsvector('simple'::regconfig, coalesce($4, '')),
    $5,
    NOW()
)
ON CONFLICT (video_id, lang)
DO UPDATE SET
    format = EXCLUDED.format,
    text = EXCLUDED.text,
    search = EXCLUDED.search,
    raw = EXCLUDED.raw,
    updated_at = NOW()
`

type UpsertVideoTranscriptParams struct {
	VideoID pgtype.UUID  `db:"video_id" json:"VideoID"`
	Lang    language.Tag `db:"lang" json:"Lang"`
	Format  string       `db:"format" json:"Format"`
	Text    string       `db:"text" json:"Text"`
	Raw     string       `db:"raw" json:"Raw"`
}

// UpsertVideoTranscript stores (or updates) a transcript for a video+lang.
//
//	INSERT INTO video_transcripts (
//	    video_id,
//	    lang,
//	    format,
//	    text,
//	    search,
//	    raw,
//	    updated_at
//	)
//	VALUES (
//	    $1,
//	    $2::language_tag,
//	    $3,
//	    $4,
//	    to_tsvector('simple'::regconfig, coalesce($4, '')),
//	    $5,
//	    NOW()
//	)
//	ON CONFLICT (video_id, lang)
//	DO UPDATE SET
//	    format = EXCLUDED.format,
//	    text = EXCLUDED.text,
//	    search = EXCLUDED.search,
//	    raw = EXCLUDED.raw,
//	    updated_at = NOW()
func (q *Queries) UpsertVideoTranscript(ctx context.Context, arg *UpsertVideoTranscriptParams) error {
	_, err := q.db.Exec(ctx, upsertVideoTranscript,
		arg.VideoID,
		arg.Lang,
		arg.Format,
		arg.Text,
		arg.Raw,
	)
	return err
}
