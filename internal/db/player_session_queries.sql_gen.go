// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: player_session_queries.sql

package db

import (
	"context"

	"github.com/jackc/pgx/v5/pgtype"
)

const clearVideoFromPlayerSessions = `-- name: ClearVideoFromPlayerSessions :exec
UPDATE player_sessions
SET current_video_id = NULL, last_activity = NOW()
WHERE current_video_id = $1
`

// ClearVideoFromPlayerSessions
//
//	UPDATE player_sessions
//	SET current_video_id = NULL, last_activity = NOW()
//	WHERE current_video_id = $1
func (q *Queries) ClearVideoFromPlayerSessions(ctx context.Context, videoID pgtype.UUID) error {
	_, err := q.db.Exec(ctx, clearVideoFromPlayerSessions, videoID)
	return err
}

const createPlayerSession = `-- name: CreatePlayerSession :one
INSERT INTO player_sessions (producer_id, session_code, expires_at)
VALUES ($1, $2, $3)
RETURNING id, session_code, producer_id, current_video_id, state, created_at, expires_at, last_activity
`

type CreatePlayerSessionParams struct {
	ProducerID  pgtype.UUID        `db:"producer_id" json:"ProducerID"`
	SessionCode string             `db:"session_code" json:"SessionCode"`
	ExpiresAt   pgtype.Timestamptz `db:"expires_at" json:"ExpiresAt"`
}

// CreatePlayerSession
//
//	INSERT INTO player_sessions (producer_id, session_code, expires_at)
//	VALUES ($1, $2, $3)
//	RETURNING id, session_code, producer_id, current_video_id, state, created_at, expires_at, last_activity
func (q *Queries) CreatePlayerSession(ctx context.Context, arg *CreatePlayerSessionParams) (*PlayerSession, error) {
	row := q.db.QueryRow(ctx, createPlayerSession, arg.ProducerID, arg.SessionCode, arg.ExpiresAt)
	var i PlayerSession
	err := row.Scan(
		&i.ID,
		&i.SessionCode,
		&i.ProducerID,
		&i.CurrentVideoID,
		&i.State,
		&i.CreatedAt,
		&i.ExpiresAt,
		&i.LastActivity,
	)
	return &i, err
}

const deletePlayerSession = `-- name: DeletePlayerSession :exec
DELETE FROM player_sessions
WHERE id = $1
`

// DeletePlayerSession
//
//	DELETE FROM player_sessions
//	WHERE id = $1
func (q *Queries) DeletePlayerSession(ctx context.Context, id pgtype.UUID) error {
	_, err := q.db.Exec(ctx, deletePlayerSession, id)
	return err
}

const getActiveSessionByProducer = `-- name: GetActiveSessionByProducer :one
SELECT id, session_code, producer_id, current_video_id, state, created_at, expires_at, last_activity FROM player_sessions
WHERE producer_id = $1 AND expires_at > NOW()
ORDER BY created_at DESC
LIMIT 1
`

// GetActiveSessionByProducer
//
//	SELECT id, session_code, producer_id, current_video_id, state, created_at, expires_at, last_activity FROM player_sessions
//	WHERE producer_id = $1 AND expires_at > NOW()
//	ORDER BY created_at DESC
//	LIMIT 1
func (q *Queries) GetActiveSessionByProducer(ctx context.Context, producerID pgtype.UUID) (*PlayerSession, error) {
	row := q.db.QueryRow(ctx, getActiveSessionByProducer, producerID)
	var i PlayerSession
	err := row.Scan(
		&i.ID,
		&i.SessionCode,
		&i.ProducerID,
		&i.CurrentVideoID,
		&i.State,
		&i.CreatedAt,
		&i.ExpiresAt,
		&i.LastActivity,
	)
	return &i, err
}

const getPlayerSessionByCode = `-- name: GetPlayerSessionByCode :one
SELECT id, session_code, producer_id, current_video_id, state, created_at, expires_at, last_activity FROM player_sessions
WHERE session_code = $1 AND expires_at > NOW()
`

// GetPlayerSessionByCode
//
//	SELECT id, session_code, producer_id, current_video_id, state, created_at, expires_at, last_activity FROM player_sessions
//	WHERE session_code = $1 AND expires_at > NOW()
func (q *Queries) GetPlayerSessionByCode(ctx context.Context, sessionCode string) (*PlayerSession, error) {
	row := q.db.QueryRow(ctx, getPlayerSessionByCode, sessionCode)
	var i PlayerSession
	err := row.Scan(
		&i.ID,
		&i.SessionCode,
		&i.ProducerID,
		&i.CurrentVideoID,
		&i.State,
		&i.CreatedAt,
		&i.ExpiresAt,
		&i.LastActivity,
	)
	return &i, err
}

const getPlayerSessionByID = `-- name: GetPlayerSessionByID :one
SELECT id, session_code, producer_id, current_video_id, state, created_at, expires_at, last_activity FROM player_sessions
WHERE id = $1
`

// GetPlayerSessionByID
//
//	SELECT id, session_code, producer_id, current_video_id, state, created_at, expires_at, last_activity FROM player_sessions
//	WHERE id = $1
func (q *Queries) GetPlayerSessionByID(ctx context.Context, id pgtype.UUID) (*PlayerSession, error) {
	row := q.db.QueryRow(ctx, getPlayerSessionByID, id)
	var i PlayerSession
	err := row.Scan(
		&i.ID,
		&i.SessionCode,
		&i.ProducerID,
		&i.CurrentVideoID,
		&i.State,
		&i.CreatedAt,
		&i.ExpiresAt,
		&i.LastActivity,
	)
	return &i, err
}

const listSessionsByProducer = `-- name: ListSessionsByProducer :many
SELECT id, session_code, producer_id, current_video_id, state, created_at, expires_at, last_activity FROM player_sessions
WHERE producer_id = $1
ORDER BY created_at DESC
`

// ListSessionsByProducer
//
//	SELECT id, session_code, producer_id, current_video_id, state, created_at, expires_at, last_activity FROM player_sessions
//	WHERE producer_id = $1
//	ORDER BY created_at DESC
func (q *Queries) ListSessionsByProducer(ctx context.Context, producerID pgtype.UUID) ([]*PlayerSession, error) {
	rows, err := q.db.Query(ctx, listSessionsByProducer, producerID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []*PlayerSession
	for rows.Next() {
		var i PlayerSession
		if err := rows.Scan(
			&i.ID,
			&i.SessionCode,
			&i.ProducerID,
			&i.CurrentVideoID,
			&i.State,
			&i.CreatedAt,
			&i.ExpiresAt,
			&i.LastActivity,
		); err != nil {
			return nil, err
		}
		items = append(items, &i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const updatePlayerSessionActivity = `-- name: UpdatePlayerSessionActivity :exec
UPDATE player_sessions
SET last_activity = NOW()
WHERE id = $1
`

// UpdatePlayerSessionActivity
//
//	UPDATE player_sessions
//	SET last_activity = NOW()
//	WHERE id = $1
func (q *Queries) UpdatePlayerSessionActivity(ctx context.Context, id pgtype.UUID) error {
	_, err := q.db.Exec(ctx, updatePlayerSessionActivity, id)
	return err
}

const updatePlayerSessionState = `-- name: UpdatePlayerSessionState :exec
UPDATE player_sessions
SET state = $1, last_activity = NOW()
WHERE id = $2
`

type UpdatePlayerSessionStateParams struct {
	State []byte      `db:"state" json:"State"`
	ID    pgtype.UUID `db:"id" json:"ID"`
}

// UpdatePlayerSessionState
//
//	UPDATE player_sessions
//	SET state = $1, last_activity = NOW()
//	WHERE id = $2
func (q *Queries) UpdatePlayerSessionState(ctx context.Context, arg *UpdatePlayerSessionStateParams) error {
	_, err := q.db.Exec(ctx, updatePlayerSessionState, arg.State, arg.ID)
	return err
}

const updatePlayerSessionVideo = `-- name: UpdatePlayerSessionVideo :exec
UPDATE player_sessions
SET current_video_id = $1, last_activity = NOW()
WHERE id = $2
`

type UpdatePlayerSessionVideoParams struct {
	VideoID pgtype.UUID `db:"video_id" json:"VideoID"`
	ID      pgtype.UUID `db:"id" json:"ID"`
}

// UpdatePlayerSessionVideo
//
//	UPDATE player_sessions
//	SET current_video_id = $1, last_activity = NOW()
//	WHERE id = $2
func (q *Queries) UpdatePlayerSessionVideo(ctx context.Context, arg *UpdatePlayerSessionVideoParams) error {
	_, err := q.db.Exec(ctx, updatePlayerSessionVideo, arg.VideoID, arg.ID)
	return err
}
