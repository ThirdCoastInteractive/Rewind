// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: video_playback_queries.sql

package db

import (
	"context"

	"github.com/jackc/pgx/v5/pgtype"
	"thirdcoast.systems/rewind/pkg/videoinfo"
)

const getVideoWithDownloadJob = `-- name: GetVideoWithDownloadJob :one
SELECT 
    v.id as video_id,
    v.src,
    v.title,
    v.info,
    v.comments,
    v.video_path,
    v.thumbnail_path,
    v.created_at as video_created_at,
    v.updated_at as video_updated_at,
    dj.id as download_job_id,
    dj.spool_dir,
    dj.info_json_path
FROM videos v
LEFT JOIN download_jobs dj ON dj.video_id = v.id
WHERE v.id = $1
`

type GetVideoWithDownloadJobRow struct {
	VideoID        pgtype.UUID         `db:"video_id" json:"VideoID"`
	Src            string              `db:"src" json:"Src"`
	Title          string              `db:"title" json:"Title"`
	Info           videoinfo.VideoInfo `db:"info" json:"Info"`
	Comments       []byte              `db:"comments" json:"Comments"`
	VideoPath      *string             `db:"video_path" json:"VideoPath"`
	ThumbnailPath  *string             `db:"thumbnail_path" json:"ThumbnailPath"`
	VideoCreatedAt pgtype.Timestamptz  `db:"video_created_at" json:"VideoCreatedAt"`
	VideoUpdatedAt pgtype.Timestamptz  `db:"video_updated_at" json:"VideoUpdatedAt"`
	DownloadJobID  pgtype.UUID         `db:"download_job_id" json:"DownloadJobID"`
	SpoolDir       *string             `db:"spool_dir" json:"SpoolDir"`
	InfoJsonPath   *string             `db:"info_json_path" json:"InfoJsonPath"`
}

// GetVideoWithDownloadJob gets a video with its download job info for playback
//
//	SELECT
//	    v.id as video_id,
//	    v.src,
//	    v.title,
//	    v.info,
//	    v.comments,
//	    v.video_path,
//	    v.thumbnail_path,
//	    v.created_at as video_created_at,
//	    v.updated_at as video_updated_at,
//	    dj.id as download_job_id,
//	    dj.spool_dir,
//	    dj.info_json_path
//	FROM videos v
//	LEFT JOIN download_jobs dj ON dj.video_id = v.id
//	WHERE v.id = $1
func (q *Queries) GetVideoWithDownloadJob(ctx context.Context, videoID pgtype.UUID) (*GetVideoWithDownloadJobRow, error) {
	row := q.db.QueryRow(ctx, getVideoWithDownloadJob, videoID)
	var i GetVideoWithDownloadJobRow
	err := row.Scan(
		&i.VideoID,
		&i.Src,
		&i.Title,
		&i.Info,
		&i.Comments,
		&i.VideoPath,
		&i.ThumbnailPath,
		&i.VideoCreatedAt,
		&i.VideoUpdatedAt,
		&i.DownloadJobID,
		&i.SpoolDir,
		&i.InfoJsonPath,
	)
	return &i, err
}
