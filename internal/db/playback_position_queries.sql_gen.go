// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: playback_position_queries.sql

package db

import (
	"context"

	"github.com/jackc/pgx/v5/pgtype"
)

const getPlaybackPosition = `-- name: GetPlaybackPosition :one
SELECT position_seconds, updated_at
FROM playback_positions
WHERE user_id = $1
  AND video_id = $2
`

type GetPlaybackPositionParams struct {
	UserID  pgtype.UUID `db:"user_id" json:"UserID"`
	VideoID pgtype.UUID `db:"video_id" json:"VideoID"`
}

type GetPlaybackPositionRow struct {
	PositionSeconds float64            `db:"position_seconds" json:"PositionSeconds"`
	UpdatedAt       pgtype.Timestamptz `db:"updated_at" json:"UpdatedAt"`
}

// GetPlaybackPosition retrieves the last playback position for a user/video
//
//	SELECT position_seconds, updated_at
//	FROM playback_positions
//	WHERE user_id = $1
//	  AND video_id = $2
func (q *Queries) GetPlaybackPosition(ctx context.Context, arg *GetPlaybackPositionParams) (*GetPlaybackPositionRow, error) {
	row := q.db.QueryRow(ctx, getPlaybackPosition, arg.UserID, arg.VideoID)
	var i GetPlaybackPositionRow
	err := row.Scan(&i.PositionSeconds, &i.UpdatedAt)
	return &i, err
}

const upsertPlaybackPosition = `-- name: UpsertPlaybackPosition :exec
INSERT INTO playback_positions (user_id, video_id, position_seconds, updated_at)
VALUES ($1, $2, $3, CURRENT_TIMESTAMP)
ON CONFLICT (user_id, video_id)
DO UPDATE SET
    position_seconds = EXCLUDED.position_seconds,
    updated_at = CURRENT_TIMESTAMP
`

type UpsertPlaybackPositionParams struct {
	UserID          pgtype.UUID `db:"user_id" json:"UserID"`
	VideoID         pgtype.UUID `db:"video_id" json:"VideoID"`
	PositionSeconds float64     `db:"position_seconds" json:"PositionSeconds"`
}

// UpsertPlaybackPosition saves or updates the playback position for a user/video
//
//	INSERT INTO playback_positions (user_id, video_id, position_seconds, updated_at)
//	VALUES ($1, $2, $3, CURRENT_TIMESTAMP)
//	ON CONFLICT (user_id, video_id)
//	DO UPDATE SET
//	    position_seconds = EXCLUDED.position_seconds,
//	    updated_at = CURRENT_TIMESTAMP
func (q *Queries) UpsertPlaybackPosition(ctx context.Context, arg *UpsertPlaybackPositionParams) error {
	_, err := q.db.Exec(ctx, upsertPlaybackPosition, arg.UserID, arg.VideoID, arg.PositionSeconds)
	return err
}
