package components

import (
	"fmt"

	"thirdcoast.systems/rewind/pkg/filters"
	"thirdcoast.systems/rewind/pkg/utils/format"
)

// TranscriptCue represents a single subtitle cue for templ rendering.
type TranscriptCue struct {
	Start float64
	End   float64
	Text  string
}

// TranscriptList renders the full transcript cue list, targeted by SSE.
// Each cue row carries data attributes for client-side filtering and time sync.
templ TranscriptList(cues []TranscriptCue) {
	<div id="transcript-list-inner">
		if len(cues) == 0 {
			<div class="text-xs text-white/40 font-mono">No captions.</div>
		}
		for _, cue := range cues {
			@TranscriptCueRow(cue)
		}
	</div>
}

// TranscriptCueRow renders a single transcript cue row with time button and text.
templ TranscriptCueRow(cue TranscriptCue) {
	<div
		class="flex items-start gap-2 text-xs font-mono py-1 transition-all"
		data-cue-start={ filters.FmtNum(cue.Start) }
		data-cue-end={ filters.FmtNum(cue.End) }
		data-cue-text={ cue.Text }
	>
		<button
			type="button"
			class="px-2 py-1 text-xs uppercase tracking-wider transition-all border-2 bg-black text-white border-white/20 hover:border-white/40 active:scale-95 flex-shrink-0"
			{ templ.Attributes{"onclick": fmt.Sprintf("window.seekToTime(%f)", cue.Start)}... }
		>
			{ format.Duration(cue.Start) }
		</button>
		<div class="text-white/80">{ cue.Text }</div>
	</div>
}
