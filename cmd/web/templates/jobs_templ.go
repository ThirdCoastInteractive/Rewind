// Code generated by templ - DO NOT EDIT.

// templ: version: v0.3.977
package templates

//lint:file-ignore SA4006 This context is only used if a nested component is present.

import "github.com/a-h/templ"
import templruntime "github.com/a-h/templ/runtime"

import (
	"fmt"
	"thirdcoast.systems/rewind/cmd/web/viewtypes"
	"thirdcoast.systems/rewind/internal/db"
)

func Jobs(jobs []*db.DownloadJob, username string) templ.Component {
	return templruntime.GeneratedTemplate(func(templ_7745c5c3_Input templruntime.GeneratedComponentInput) (templ_7745c5c3_Err error) {
		templ_7745c5c3_W, ctx := templ_7745c5c3_Input.Writer, templ_7745c5c3_Input.Context
		if templ_7745c5c3_CtxErr := ctx.Err(); templ_7745c5c3_CtxErr != nil {
			return templ_7745c5c3_CtxErr
		}
		templ_7745c5c3_Buffer, templ_7745c5c3_IsBuffer := templruntime.GetBuffer(templ_7745c5c3_W)
		if !templ_7745c5c3_IsBuffer {
			defer func() {
				templ_7745c5c3_BufErr := templruntime.ReleaseBuffer(templ_7745c5c3_Buffer)
				if templ_7745c5c3_Err == nil {
					templ_7745c5c3_Err = templ_7745c5c3_BufErr
				}
			}()
		}
		ctx = templ.InitializeContext(ctx)
		templ_7745c5c3_Var1 := templ.GetChildren(ctx)
		if templ_7745c5c3_Var1 == nil {
			templ_7745c5c3_Var1 = templ.NopComponent
		}
		ctx = templ.ClearChildren(ctx)
		templ_7745c5c3_Var2 := templruntime.GeneratedTemplate(func(templ_7745c5c3_Input templruntime.GeneratedComponentInput) (templ_7745c5c3_Err error) {
			templ_7745c5c3_W, ctx := templ_7745c5c3_Input.Writer, templ_7745c5c3_Input.Context
			templ_7745c5c3_Buffer, templ_7745c5c3_IsBuffer := templruntime.GetBuffer(templ_7745c5c3_W)
			if !templ_7745c5c3_IsBuffer {
				defer func() {
					templ_7745c5c3_BufErr := templruntime.ReleaseBuffer(templ_7745c5c3_Buffer)
					if templ_7745c5c3_Err == nil {
						templ_7745c5c3_Err = templ_7745c5c3_BufErr
					}
				}()
			}
			ctx = templ.InitializeContext(ctx)
			templ_7745c5c3_Err = JobsContent(jobs).Render(ctx, templ_7745c5c3_Buffer)
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			return nil
		})
		templ_7745c5c3_Err = Layout("My Jobs", username).Render(templ.WithChildren(ctx, templ_7745c5c3_Var2), templ_7745c5c3_Buffer)
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		return nil
	})
}

func JobsContent(jobs []*db.DownloadJob) templ.Component {
	return templruntime.GeneratedTemplate(func(templ_7745c5c3_Input templruntime.GeneratedComponentInput) (templ_7745c5c3_Err error) {
		templ_7745c5c3_W, ctx := templ_7745c5c3_Input.Writer, templ_7745c5c3_Input.Context
		if templ_7745c5c3_CtxErr := ctx.Err(); templ_7745c5c3_CtxErr != nil {
			return templ_7745c5c3_CtxErr
		}
		templ_7745c5c3_Buffer, templ_7745c5c3_IsBuffer := templruntime.GetBuffer(templ_7745c5c3_W)
		if !templ_7745c5c3_IsBuffer {
			defer func() {
				templ_7745c5c3_BufErr := templruntime.ReleaseBuffer(templ_7745c5c3_Buffer)
				if templ_7745c5c3_Err == nil {
					templ_7745c5c3_Err = templ_7745c5c3_BufErr
				}
			}()
		}
		ctx = templ.InitializeContext(ctx)
		templ_7745c5c3_Var3 := templ.GetChildren(ctx)
		if templ_7745c5c3_Var3 == nil {
			templ_7745c5c3_Var3 = templ.NopComponent
		}
		ctx = templ.ClearChildren(ctx)
		templ_7745c5c3_Var4 := templruntime.GeneratedTemplate(func(templ_7745c5c3_Input templruntime.GeneratedComponentInput) (templ_7745c5c3_Err error) {
			templ_7745c5c3_W, ctx := templ_7745c5c3_Input.Writer, templ_7745c5c3_Input.Context
			templ_7745c5c3_Buffer, templ_7745c5c3_IsBuffer := templruntime.GetBuffer(templ_7745c5c3_W)
			if !templ_7745c5c3_IsBuffer {
				defer func() {
					templ_7745c5c3_BufErr := templruntime.ReleaseBuffer(templ_7745c5c3_Buffer)
					if templ_7745c5c3_Err == nil {
						templ_7745c5c3_Err = templ_7745c5c3_BufErr
					}
				}()
			}
			ctx = templ.InitializeContext(ctx)
			templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 1, "<div class=\"mb-4\"><div class=\"flex items-center justify-between\"><div><h1 class=\"text-xl font-mono uppercase tracking-tight text-white mb-0.5\">Download Jobs</h1><p class=\"text-xs font-mono text-white/60\">All submitted download jobs and their status</p></div>")
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			var templ_7745c5c3_Var5 = []any{viewtypes.GhostButtonSm + " text-white/60 border-white/40 hover:border-white hover:text-white"}
			templ_7745c5c3_Err = templ.RenderCSSItems(ctx, templ_7745c5c3_Buffer, templ_7745c5c3_Var5...)
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			templ_7745c5c3_Err = templ.RenderScriptItems(ctx, templ_7745c5c3_Buffer, templ.ComponentScript{Call: "toggleCheckboxes()"})
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 2, "<button id=\"toggle-checkboxes-btn\" type=\"button\" onclick=\"")
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			var templ_7745c5c3_Var6 templ.ComponentScript = templ.ComponentScript{Call: "toggleCheckboxes()"}
			_, templ_7745c5c3_Err = templ_7745c5c3_Buffer.WriteString(templ_7745c5c3_Var6.Call)
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 3, "\" class=\"")
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			var templ_7745c5c3_Var7 string
			templ_7745c5c3_Var7, templ_7745c5c3_Err = templ.JoinStringErrs(templ.CSSClasses(templ_7745c5c3_Var5).String())
			if templ_7745c5c3_Err != nil {
				return templ.Error{Err: templ_7745c5c3_Err, FileName: `cmd/web/templates/jobs.templ`, Line: 1, Col: 0}
			}
			_, templ_7745c5c3_Err = templ_7745c5c3_Buffer.WriteString(templ.EscapeString(templ_7745c5c3_Var7))
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 4, "\"><i class=\"fa-sharp fa-solid fa-check-square mr-1\" aria-hidden=\"true\"></i> Select Mode</button></div></div><div id=\"bulk-actions-bar\" class=\"hidden mb-4 p-2 border-2 border-white/20 bg-white/5\"><div class=\"flex items-center justify-between gap-4\"><div class=\"flex items-center gap-2\">")
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			templ_7745c5c3_Err = templ.RenderScriptItems(ctx, templ_7745c5c3_Buffer, templ.ComponentScript{Call: "toggleSelectAll(event)"})
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 5, "<input type=\"checkbox\" id=\"select-all-checkbox\" class=\"job-checkbox w-4 h-4 bg-black border-2 border-white/40 cursor-pointer\" style=\"display: none;\" onchange=\"")
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			var templ_7745c5c3_Var8 templ.ComponentScript = templ.ComponentScript{Call: "toggleSelectAll(event)"}
			_, templ_7745c5c3_Err = templ_7745c5c3_Buffer.WriteString(templ_7745c5c3_Var8.Call)
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 6, "\"> <span id=\"selection-count\" class=\"text-xs font-mono text-white\">0 selected</span></div>")
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			templ_7745c5c3_Err = templ.RenderScriptItems(ctx, templ_7745c5c3_Buffer, templ.ComponentScript{Call: "bulkArchiveJobs()"})
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 7, "<button id=\"bulk-archive-btn\" type=\"button\" onclick=\"")
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			var templ_7745c5c3_Var9 templ.ComponentScript = templ.ComponentScript{Call: "bulkArchiveJobs()"}
			_, templ_7745c5c3_Err = templ_7745c5c3_Buffer.WriteString(templ_7745c5c3_Var9.Call)
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 8, "\" class=\"px-3 py-1 text-xs font-mono uppercase tracking-wider transition-all border-2 bg-black text-white border-white hover:bg-white hover:text-black active:scale-95\">Archive Selected</button></div></div><div class=\"flex gap-0 mb-4 border-b-2 border-white/10\"><button class=\"tab-button px-2 py-1 text-xs font-mono uppercase tracking-wider text-white border-b-2 border-white -mb-0.5\" data-status=\"all\">All</button> <button class=\"tab-button px-2 py-1 text-xs font-mono uppercase tracking-wider text-white/40 hover:text-white/70 border-b-2 border-transparent -mb-0.5\" data-status=\"queued\">Queued</button> <button class=\"tab-button px-2 py-1 text-xs font-mono uppercase tracking-wider text-white/40 hover:text-white/70 border-b-2 border-transparent -mb-0.5\" data-status=\"processing\">Processing</button> <button class=\"tab-button px-2 py-1 text-xs font-mono uppercase tracking-wider text-white/40 hover:text-white/70 border-b-2 border-transparent -mb-0.5\" data-status=\"succeeded\">Succeeded</button> <button class=\"tab-button px-2 py-1 text-xs font-mono uppercase tracking-wider text-white/40 hover:text-white/70 border-b-2 border-transparent -mb-0.5\" data-status=\"failed\">Failed</button></div>")
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			if jobs == nil {
				templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 9, "<div id=\"jobs-list\" class=\"border-2 border-white/10\" data-init=\"@get('/api/jobs/index')\"><div class=\"p-2 text-xs font-mono text-white/40\">Loading…</div></div>")
				if templ_7745c5c3_Err != nil {
					return templ_7745c5c3_Err
				}
			} else {
				templ_7745c5c3_Err = JobsList(jobs).Render(ctx, templ_7745c5c3_Buffer)
				if templ_7745c5c3_Err != nil {
					return templ_7745c5c3_Err
				}
			}
			return nil
		})
		templ_7745c5c3_Err = Container("").Render(templ.WithChildren(ctx, templ_7745c5c3_Var4), templ_7745c5c3_Buffer)
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 10, "<script>\n\t\t// Multi-select state\n\t\tconst selectedJobs = new Set();\n\t\tlet checkboxesVisible = false;\n\t\tlet lastCheckedIndex = null;\n\n\t\tfunction toggleCheckboxes() {\n\t\t\tcheckboxesVisible = !checkboxesVisible;\n\t\t\tconst checkboxes = document.querySelectorAll('.job-checkbox');\n\t\t\tconst btn = document.getElementById('toggle-checkboxes-btn');\n\t\t\t\n\t\t\tcheckboxes.forEach(checkbox => {\n\t\t\t\tcheckbox.style.display = checkboxesVisible ? 'block' : 'none';\n\t\t\t});\n\t\t\t\n\t\t\tif (checkboxesVisible) {\n\t\t\t\tbtn.classList.remove('text-white/60', 'border-white/40');\n\t\t\t\tbtn.classList.add('text-white', 'border-white');\n\t\t\t} else {\n\t\t\t\tbtn.classList.remove('text-white', 'border-white');\n\t\t\t\tbtn.classList.add('text-white/60', 'border-white/40');\n\t\t\t\t// Clear selections when hiding\n\t\t\t\tselectedJobs.clear();\n\t\t\t\tcheckboxes.forEach(checkbox => checkbox.checked = false);\n\t\t\t\tupdateSelectionUI();\n\t\t\t}\n\t\t}\n\n\t\tfunction updateSelectionUI() {\n\t\t\tconst count = selectedJobs.size;\n\t\t\tconst bar = document.getElementById('bulk-actions-bar');\n\t\t\tconst countText = document.getElementById('selection-count');\n\t\t\t\n\t\t\tif (count > 0) {\n\t\t\t\tbar.classList.remove('hidden');\n\t\t\t\tcountText.textContent = `${count} selected`;\n\t\t\t} else {\n\t\t\t\tbar.classList.add('hidden');\n\t\t\t}\n\n\t\t\t// Update select-all checkbox state\n\t\t\tconst allCheckboxes = document.querySelectorAll('.job-checkbox:not(#select-all-checkbox)');\n\t\t\tconst selectAllCheckbox = document.getElementById('select-all-checkbox');\n\t\t\tif (selectAllCheckbox) {\n\t\t\t\tselectAllCheckbox.checked = allCheckboxes.length > 0 && allCheckboxes.length === selectedJobs.size;\n\t\t\t\tselectAllCheckbox.indeterminate = selectedJobs.size > 0 && selectedJobs.size < allCheckboxes.length;\n\t\t\t}\n\t\t}\n\n\t\tfunction toggleJobSelection(event, jobId) {\n\t\t\tevent.stopPropagation();\n\t\t\t\n\t\t\tconst allCheckboxes = Array.from(document.querySelectorAll('.job-checkbox:not(#select-all-checkbox)'));\n\t\t\tconst currentIndex = allCheckboxes.findIndex(cb => cb.dataset.jobId === jobId);\n\t\t\t\n\t\t\t// Shift-click range selection\n\t\t\tif (event.shiftKey && lastCheckedIndex !== null && currentIndex !== -1) {\n\t\t\t\tconst start = Math.min(lastCheckedIndex, currentIndex);\n\t\t\t\tconst end = Math.max(lastCheckedIndex, currentIndex);\n\t\t\t\tconst shouldSelect = event.target.checked;\n\t\t\t\t\n\t\t\t\tfor (let i = start; i <= end; i++) {\n\t\t\t\t\tconst checkbox = allCheckboxes[i];\n\t\t\t\t\tcheckbox.checked = shouldSelect;\n\t\t\t\t\tif (shouldSelect) {\n\t\t\t\t\t\tselectedJobs.add(checkbox.dataset.jobId);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tselectedJobs.delete(checkbox.dataset.jobId);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Normal click\n\t\t\t\tif (event.target.checked) {\n\t\t\t\t\tselectedJobs.add(jobId);\n\t\t\t\t} else {\n\t\t\t\t\tselectedJobs.delete(jobId);\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tif (currentIndex !== -1) {\n\t\t\t\tlastCheckedIndex = currentIndex;\n\t\t\t}\n\t\t\t\n\t\t\tupdateSelectionUI();\n\t\t}\n\n\t\tfunction toggleSelectAll(event) {\n\t\t\tconst allCheckboxes = document.querySelectorAll('.job-checkbox:not(#select-all-checkbox)');\n\t\t\tconst shouldSelect = event.target.checked;\n\t\t\t\n\t\t\tselectedJobs.clear();\n\t\t\tallCheckboxes.forEach(checkbox => {\n\t\t\t\tcheckbox.checked = shouldSelect;\n\t\t\t\tif (shouldSelect) {\n\t\t\t\t\tselectedJobs.add(checkbox.dataset.jobId);\n\t\t\t\t}\n\t\t\t});\n\t\t\tupdateSelectionUI();\n\t\t}\n\n\t\tasync function bulkArchiveJobs() {\n\t\t\tif (selectedJobs.size === 0) return;\n\t\t\t\n\t\t\tconst count = selectedJobs.size;\n\t\t\tif (!confirm(`Archive ${count} job${count > 1 ? 's' : ''}?`)) return;\n\n\t\t\tconst btn = document.getElementById('bulk-archive-btn');\n\t\t\tbtn.disabled = true;\n\t\t\tbtn.textContent = 'Archiving...';\n\n\t\t\ttry {\n\t\t\t\tconst response = await fetch('/api/jobs/archive', {\n\t\t\t\t\tmethod: 'POST',\n\t\t\t\t\theaders: { 'Content-Type': 'application/json' },\n\t\t\t\t\tbody: JSON.stringify({ job_ids: Array.from(selectedJobs) })\n\t\t\t\t});\n\n\t\t\t\tif (response.ok) {\n\t\t\t\t\t// Remove archived jobs from view\n\t\t\t\t\tselectedJobs.forEach(jobId => {\n\t\t\t\t\t\tconst card = document.getElementById(`job-card-${jobId}`);\n\t\t\t\t\t\tif (card) card.remove();\n\t\t\t\t\t});\n\t\t\t\t\tselectedJobs.clear();\n\t\t\t\t\tupdateSelectionUI();\n\t\t\t\t} else {\n\t\t\t\t\tconst text = await response.text();\n\t\t\t\t\talert('Failed to archive jobs: ' + text);\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\talert('Error: ' + error.message);\n\t\t\t} finally {\n\t\t\t\tbtn.disabled = false;\n\t\t\t\tbtn.textContent = 'Archive Selected';\n\t\t\t}\n\t\t}\n\n\t\tasync function archiveJob(event, jobId) {\n\t\t\tevent.preventDefault();\n\t\t\tevent.stopPropagation();\n\t\t\tif (!confirm('Archive this job?')) return;\n\n\t\t\tconst btn = event.target;\n\t\t\tbtn.disabled = true;\n\n\t\t\ttry {\n\t\t\t\tconst response = await fetch(`/api/jobs/${jobId}/archive`, {\n\t\t\t\t\tmethod: 'POST',\n\t\t\t\t\theaders: { 'Content-Type': 'application/json' },\n\t\t\t\t});\n\n\t\t\t\tif (response.ok) {\n\t\t\t\t\tconst card = document.getElementById(`job-card-${jobId}`);\n\t\t\t\t\tif (card) card.remove();\n\t\t\t\t} else {\n\t\t\t\t\tconst text = await response.text();\n\t\t\t\t\talert('Failed to archive job: ' + text);\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\talert('Error: ' + error.message);\n\t\t\t} finally {\n\t\t\t\tbtn.disabled = false;\n\t\t\t}\n\t\t}\n\n\t\tfunction applyJobsFilter(filterStatus) {\n\t\t\tdocument.querySelectorAll('.job-card').forEach(card => {\n\t\t\t\tconst cardStatus = (card.getAttribute('data-status') || '').toLowerCase();\n\t\t\t\tif (filterStatus === 'all' || cardStatus === filterStatus) {\n\t\t\t\t\tcard.style.display = 'block';\n\t\t\t\t} else {\n\t\t\t\t\tcard.style.display = 'none';\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tfunction setActiveTab(activeButton) {\n\t\t\tconst tabButtons = document.querySelectorAll('.tab-button');\n\t\t\ttabButtons.forEach(btn => {\n\t\t\t\tif (btn === activeButton) {\n\t\t\t\t\tbtn.classList.remove('text-white/40', 'hover:text-white/70', 'border-transparent');\n\t\t\t\t\tbtn.classList.add('text-white', 'border-white');\n\t\t\t\t} else {\n\t\t\t\t\tbtn.classList.remove('text-white', 'border-white');\n\t\t\t\t\tbtn.classList.add('text-white/40', 'hover:text-white/70', 'border-transparent');\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tasync function postJobAction(jobId, action) {\n\t\t\tconst response = await fetch(`/api/jobs/${jobId}/${action}`, {\n\t\t\t\tmethod: 'POST',\n\t\t\t\theaders: { 'Content-Type': 'application/json' },\n\t\t\t});\n\t\t\tif (!response.ok) {\n\t\t\t\tconst text = await response.text();\n\t\t\t\tthrow new Error(text || `Failed to ${action} job`);\n\t\t\t}\n\t\t\treturn response.json().catch(() => ({}));\n\t\t}\n\n\t\t// Called by onclick handlers from templ.JSFuncCall\n\t\tasync function retryJob(event, jobId) {\n\t\t\tevent.preventDefault();\n\t\t\tevent.stopPropagation();\n\t\t\tconst btn = event.target;\n\t\t\tbtn.disabled = true;\n\t\t\ttry {\n\t\t\t\tawait postJobAction(jobId, 'retry');\n\t\t\t\t// No reload; SSE will refresh the job card\n\t\t\t} catch (err) {\n\t\t\t\tconsole.error(err);\n\t\t\t\talert(err.message || 'Failed to retry job');\n\t\t\t} finally {\n\t\t\t\tbtn.disabled = false;\n\t\t\t}\n\t\t}\n\n\t\tasync function cancelJob(event, jobId) {\n\t\t\tevent.preventDefault();\n\t\t\tevent.stopPropagation();\n\t\t\tif (!confirm('Are you sure you want to cancel this job?')) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst btn = event.target;\n\t\t\tbtn.disabled = true;\n\t\t\ttry {\n\t\t\t\tawait postJobAction(jobId, 'cancel');\n\t\t\t\t// No reload; SSE will refresh the job card\n\t\t\t} catch (err) {\n\t\t\t\tconsole.error(err);\n\t\t\t\talert(err.message || 'Failed to cancel job');\n\t\t\t} finally {\n\t\t\t\tbtn.disabled = false;\n\t\t\t}\n\t\t}\n\n\t\tfunction upsertJobCardHTML(html) {\n\t\t\tif (!html) return;\n\t\t\tconst parser = new DOMParser();\n\t\t\tconst doc = parser.parseFromString(html, 'text/html');\n\t\t\tconst node = doc.body.firstElementChild;\n\t\t\tif (!node) return;\n\t\t\tconst id = node.getAttribute('id');\n\t\t\tif (!id) return;\n\t\t\t\n\t\t\t// Preserve checkbox visibility when updating cards\n\t\t\tconst checkbox = node.querySelector('.job-checkbox');\n\t\t\tif (checkbox && checkboxesVisible) {\n\t\t\t\tcheckbox.style.display = 'block';\n\t\t\t}\n\t\t\t\n\t\t\tconst existing = document.getElementById(id);\n\t\t\tif (existing) {\n\t\t\t\texisting.replaceWith(node);\n\t\t\t} else {\n\t\t\t\tconst list = document.getElementById('jobs-list');\n\t\t\t\tif (list) list.prepend(node);\n\t\t\t}\n\t\t}\n\n\t\tdocument.addEventListener('DOMContentLoaded', function() {\n\t\t\t// Tabs\n\t\t\tdocument.querySelectorAll('.tab-button').forEach(button => {\n\t\t\t\tbutton.addEventListener('click', function() {\n\t\t\t\t\tconst filterStatus = this.getAttribute('data-status');\n\t\t\t\t\tsetActiveTab(this);\n\t\t\t\t\tapplyJobsFilter(filterStatus || 'all');\n\t\t\t\t});\n\t\t\t});\n\n\t\t\t// Live updates via SSE\n\t\t\ttry {\n\t\t\t\tconst es = new EventSource('/api/jobs/stream');\n\t\t\t\tes.addEventListener('download_job', (evt) => {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconst payload = JSON.parse(evt.data);\n\t\t\t\t\t\tupsertJobCardHTML(payload.jobs_card_html);\n\t\t\t\t\t\tconst active = document.querySelector('.tab-button.text-white');\n\t\t\t\t\t\tconst status = active ? active.getAttribute('data-status') : 'all';\n\t\t\t\t\t\tapplyJobsFilter(status || 'all');\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tconsole.warn('bad SSE payload', e);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} catch (e) {\n\t\t\t\tconsole.warn('SSE unavailable', e);\n\t\t\t}\n\t\t});\n\t</script>")
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		return nil
	})
}

func JobsList(jobs []*db.DownloadJob) templ.Component {
	return templruntime.GeneratedTemplate(func(templ_7745c5c3_Input templruntime.GeneratedComponentInput) (templ_7745c5c3_Err error) {
		templ_7745c5c3_W, ctx := templ_7745c5c3_Input.Writer, templ_7745c5c3_Input.Context
		if templ_7745c5c3_CtxErr := ctx.Err(); templ_7745c5c3_CtxErr != nil {
			return templ_7745c5c3_CtxErr
		}
		templ_7745c5c3_Buffer, templ_7745c5c3_IsBuffer := templruntime.GetBuffer(templ_7745c5c3_W)
		if !templ_7745c5c3_IsBuffer {
			defer func() {
				templ_7745c5c3_BufErr := templruntime.ReleaseBuffer(templ_7745c5c3_Buffer)
				if templ_7745c5c3_Err == nil {
					templ_7745c5c3_Err = templ_7745c5c3_BufErr
				}
			}()
		}
		ctx = templ.InitializeContext(ctx)
		templ_7745c5c3_Var10 := templ.GetChildren(ctx)
		if templ_7745c5c3_Var10 == nil {
			templ_7745c5c3_Var10 = templ.NopComponent
		}
		ctx = templ.ClearChildren(ctx)
		templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 11, "<div id=\"jobs-list\" class=\"border-2 border-white/10\">")
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		if len(jobs) > 0 {
			for _, job := range jobs {
				templ_7745c5c3_Err = DownloadJobCard(job).Render(ctx, templ_7745c5c3_Buffer)
				if templ_7745c5c3_Err != nil {
					return templ_7745c5c3_Err
				}
			}
		} else {
			templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 12, "<div class=\"p-8\">")
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			templ_7745c5c3_Err = EmptyState("inbox", "No jobs", "No download jobs have been submitted.").Render(ctx, templ_7745c5c3_Buffer)
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 13, "</div>")
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
		}
		templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 14, "</div>")
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		return nil
	})
}

func DownloadJobCard(job *db.DownloadJob) templ.Component {
	return templruntime.GeneratedTemplate(func(templ_7745c5c3_Input templruntime.GeneratedComponentInput) (templ_7745c5c3_Err error) {
		templ_7745c5c3_W, ctx := templ_7745c5c3_Input.Writer, templ_7745c5c3_Input.Context
		if templ_7745c5c3_CtxErr := ctx.Err(); templ_7745c5c3_CtxErr != nil {
			return templ_7745c5c3_CtxErr
		}
		templ_7745c5c3_Buffer, templ_7745c5c3_IsBuffer := templruntime.GetBuffer(templ_7745c5c3_W)
		if !templ_7745c5c3_IsBuffer {
			defer func() {
				templ_7745c5c3_BufErr := templruntime.ReleaseBuffer(templ_7745c5c3_Buffer)
				if templ_7745c5c3_Err == nil {
					templ_7745c5c3_Err = templ_7745c5c3_BufErr
				}
			}()
		}
		ctx = templ.InitializeContext(ctx)
		templ_7745c5c3_Var11 := templ.GetChildren(ctx)
		if templ_7745c5c3_Var11 == nil {
			templ_7745c5c3_Var11 = templ.NopComponent
		}
		ctx = templ.ClearChildren(ctx)
		templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 15, "<a href=\"")
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		var templ_7745c5c3_Var12 templ.SafeURL
		templ_7745c5c3_Var12, templ_7745c5c3_Err = templ.JoinURLErrs(templ.SafeURL("/jobs/" + job.ID.String()))
		if templ_7745c5c3_Err != nil {
			return templ.Error{Err: templ_7745c5c3_Err, FileName: `cmd/web/templates/jobs.templ`, Line: 404, Col: 50}
		}
		_, templ_7745c5c3_Err = templ_7745c5c3_Buffer.WriteString(templ.EscapeString(templ_7745c5c3_Var12))
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 16, "\" id=\"")
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		var templ_7745c5c3_Var13 string
		templ_7745c5c3_Var13, templ_7745c5c3_Err = templ.JoinStringErrs("job-card-" + job.ID.String())
		if templ_7745c5c3_Err != nil {
			return templ.Error{Err: templ_7745c5c3_Err, FileName: `cmd/web/templates/jobs.templ`, Line: 405, Col: 36}
		}
		_, templ_7745c5c3_Err = templ_7745c5c3_Buffer.WriteString(templ.EscapeString(templ_7745c5c3_Var13))
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 17, "\" class=\"job-card block border-b-2 border-white/10 p-2 hover:bg-white/5 transition-colors cursor-pointer\" data-status=\"")
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		var templ_7745c5c3_Var14 string
		templ_7745c5c3_Var14, templ_7745c5c3_Err = templ.JoinStringErrs(job.Status)
		if templ_7745c5c3_Err != nil {
			return templ.Error{Err: templ_7745c5c3_Err, FileName: `cmd/web/templates/jobs.templ`, Line: 407, Col: 26}
		}
		_, templ_7745c5c3_Err = templ_7745c5c3_Buffer.WriteString(templ.EscapeString(templ_7745c5c3_Var14))
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 18, "\"><div class=\"flex items-center gap-3\">")
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		templ_7745c5c3_Err = templ.RenderScriptItems(ctx, templ_7745c5c3_Buffer, templ.ComponentScript{Call: "event.stopPropagation()"})
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 19, "<div class=\"flex-shrink-0\" onclick=\"")
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		var templ_7745c5c3_Var15 templ.ComponentScript = templ.ComponentScript{Call: "event.stopPropagation()"}
		_, templ_7745c5c3_Err = templ_7745c5c3_Buffer.WriteString(templ_7745c5c3_Var15.Call)
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 20, "\">")
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		templ_7745c5c3_Err = templ.RenderScriptItems(ctx, templ_7745c5c3_Buffer, templ.JSFuncCall("toggleJobSelection", templ.JSExpression("event"), job.ID.String()))
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 21, "<input type=\"checkbox\" class=\"job-checkbox w-4 h-4 bg-black border-2 border-white/40 cursor-pointer\" style=\"display: none;\" data-job-id=\"")
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		var templ_7745c5c3_Var16 string
		templ_7745c5c3_Var16, templ_7745c5c3_Err = templ.JoinStringErrs(job.ID.String())
		if templ_7745c5c3_Err != nil {
			return templ.Error{Err: templ_7745c5c3_Err, FileName: `cmd/web/templates/jobs.templ`, Line: 415, Col: 34}
		}
		_, templ_7745c5c3_Err = templ_7745c5c3_Buffer.WriteString(templ.EscapeString(templ_7745c5c3_Var16))
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 22, "\" onchange=\"")
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		var templ_7745c5c3_Var17 templ.ComponentScript = templ.JSFuncCall("toggleJobSelection", templ.JSExpression("event"), job.ID.String())
		_, templ_7745c5c3_Err = templ_7745c5c3_Buffer.WriteString(templ_7745c5c3_Var17.Call)
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 23, "\"></div><div class=\"flex-shrink-0\">")
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		templ_7745c5c3_Err = StatusBadge(job.Status).Render(ctx, templ_7745c5c3_Buffer)
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 24, "</div><div class=\"flex-1 min-w-0\"><p class=\"text-xs font-mono text-white truncate\">")
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		var templ_7745c5c3_Var18 string
		templ_7745c5c3_Var18, templ_7745c5c3_Err = templ.JoinStringErrs(job.URL)
		if templ_7745c5c3_Err != nil {
			return templ.Error{Err: templ_7745c5c3_Err, FileName: `cmd/web/templates/jobs.templ`, Line: 423, Col: 62}
		}
		_, templ_7745c5c3_Err = templ_7745c5c3_Buffer.WriteString(templ.EscapeString(templ_7745c5c3_Var18))
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 25, "</p></div><div class=\"flex items-center gap-4 text-xs font-mono text-white/60\"><span>")
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		var templ_7745c5c3_Var19 string
		templ_7745c5c3_Var19, templ_7745c5c3_Err = templ.JoinStringErrs(job.CreatedAt.Time.Format("Jan 2 15:04"))
		if templ_7745c5c3_Err != nil {
			return templ.Error{Err: templ_7745c5c3_Err, FileName: `cmd/web/templates/jobs.templ`, Line: 426, Col: 52}
		}
		_, templ_7745c5c3_Err = templ_7745c5c3_Buffer.WriteString(templ.EscapeString(templ_7745c5c3_Var19))
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 26, "</span> <span>×")
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		var templ_7745c5c3_Var20 string
		templ_7745c5c3_Var20, templ_7745c5c3_Err = templ.JoinStringErrs(fmt.Sprintf("%d", job.Attempts))
		if templ_7745c5c3_Err != nil {
			return templ.Error{Err: templ_7745c5c3_Err, FileName: `cmd/web/templates/jobs.templ`, Line: 427, Col: 45}
		}
		_, templ_7745c5c3_Err = templ_7745c5c3_Buffer.WriteString(templ.EscapeString(templ_7745c5c3_Var20))
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 27, "</span></div><div class=\"flex items-center gap-2\">")
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		if job.Status == "failed" || job.Status == "succeeded" {
			templ_7745c5c3_Err = templ.RenderScriptItems(ctx, templ_7745c5c3_Buffer, templ.ComponentScript{Call: "event.preventDefault(); event.stopPropagation();"})
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 28, "<div onclick=\"")
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			var templ_7745c5c3_Var21 templ.ComponentScript = templ.ComponentScript{Call: "event.preventDefault(); event.stopPropagation();"}
			_, templ_7745c5c3_Err = templ_7745c5c3_Buffer.WriteString(templ_7745c5c3_Var21.Call)
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 29, "\">")
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			templ_7745c5c3_Err = templ.RenderScriptItems(ctx, templ_7745c5c3_Buffer, templ.JSFuncCall("retryJob", templ.JSExpression("event"), job.ID.String()))
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 30, "<button type=\"button\" onclick=\"")
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			var templ_7745c5c3_Var22 templ.ComponentScript = templ.JSFuncCall("retryJob", templ.JSExpression("event"), job.ID.String())
			_, templ_7745c5c3_Err = templ_7745c5c3_Buffer.WriteString(templ_7745c5c3_Var22.Call)
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 31, "\" class=\"px-3 py-1 text-xs font-mono uppercase tracking-wider transition-all border-2 bg-black text-white border-white hover:bg-white hover:text-black active:scale-95\">RETRY</button></div>")
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
		}
		if job.Status == "processing" {
			templ_7745c5c3_Err = templ.RenderScriptItems(ctx, templ_7745c5c3_Buffer, templ.ComponentScript{Call: "event.preventDefault(); event.stopPropagation();"})
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 32, "<div onclick=\"")
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			var templ_7745c5c3_Var23 templ.ComponentScript = templ.ComponentScript{Call: "event.preventDefault(); event.stopPropagation();"}
			_, templ_7745c5c3_Err = templ_7745c5c3_Buffer.WriteString(templ_7745c5c3_Var23.Call)
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 33, "\">")
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			templ_7745c5c3_Err = templ.RenderScriptItems(ctx, templ_7745c5c3_Buffer, templ.JSFuncCall("cancelJob", templ.JSExpression("event"), job.ID.String()))
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 34, "<button type=\"button\" onclick=\"")
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			var templ_7745c5c3_Var24 templ.ComponentScript = templ.JSFuncCall("cancelJob", templ.JSExpression("event"), job.ID.String())
			_, templ_7745c5c3_Err = templ_7745c5c3_Buffer.WriteString(templ_7745c5c3_Var24.Call)
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 35, "\" class=\"px-3 py-1 text-xs font-mono uppercase tracking-wider transition-all border-2 bg-white text-black border-black hover:bg-black hover:text-white active:scale-95\">CANCEL</button></div>")
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
		}
		templ_7745c5c3_Err = templ.RenderScriptItems(ctx, templ_7745c5c3_Buffer, templ.ComponentScript{Call: "event.preventDefault(); event.stopPropagation();"})
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 36, "<div onclick=\"")
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		var templ_7745c5c3_Var25 templ.ComponentScript = templ.ComponentScript{Call: "event.preventDefault(); event.stopPropagation();"}
		_, templ_7745c5c3_Err = templ_7745c5c3_Buffer.WriteString(templ_7745c5c3_Var25.Call)
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 37, "\">")
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		templ_7745c5c3_Err = templ.RenderScriptItems(ctx, templ_7745c5c3_Buffer, templ.JSFuncCall("archiveJob", templ.JSExpression("event"), job.ID.String()))
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 38, "<button type=\"button\" onclick=\"")
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		var templ_7745c5c3_Var26 templ.ComponentScript = templ.JSFuncCall("archiveJob", templ.JSExpression("event"), job.ID.String())
		_, templ_7745c5c3_Err = templ_7745c5c3_Buffer.WriteString(templ_7745c5c3_Var26.Call)
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 39, "\" class=\"px-3 py-1 text-xs font-mono uppercase tracking-wider transition-all border-2 bg-black text-white/60 border-white/40 hover:border-white hover:text-white active:scale-95\" title=\"Archive job (soft delete)\">ARCHIVE</button></div></div></div>")
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		if job.LastError != nil && *job.LastError != "" {
			templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 40, "<div class=\"mt-1 ml-8 text-xs font-mono text-white/60 truncate\">ERROR: ")
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			var templ_7745c5c3_Var27 string
			templ_7745c5c3_Var27, templ_7745c5c3_Err = templ.JoinStringErrs(*job.LastError)
			if templ_7745c5c3_Err != nil {
				return templ.Error{Err: templ_7745c5c3_Err, FileName: `cmd/web/templates/jobs.templ`, Line: 466, Col: 27}
			}
			_, templ_7745c5c3_Err = templ_7745c5c3_Buffer.WriteString(templ.EscapeString(templ_7745c5c3_Var27))
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 41, "</div>")
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
		}
		templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 42, "</a>")
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		return nil
	})
}

var _ = templruntime.GeneratedTemplate
